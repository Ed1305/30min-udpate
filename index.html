<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Campaign & Teams Performance</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root{
  --bg:#f0f4f8; --card:#ffffff; --text:#1e293b; --muted:#64748b;
  --border:#cbd5e1; --highlight:#e2e8f0; --total-bg:#1e3a8a;
  --radius:8px; --bar-height:20px; --accent-start:#60a5fa;
  --accent-mid:#3b82f6; --accent-end:#10b981;
}

html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--text);}
body{padding:20px; display:flex; flex-direction:column; align-items:center; gap:25px;}

h2{margin:0;font-size:24px;font-weight:700;width:96%; text-align:left;}

.wrap{width:96%; max-width:1400px;}

table{width:100%; border-collapse:collapse; table-layout:fixed; background:var(--card); font-size:18px; border-radius:var(--radius); overflow:hidden; box-shadow:0 6px 16px rgba(0,0,0,0.05);}
thead th{background:#f1f5f9;padding:16px 10px; border-bottom:1px solid var(--border); font-weight:700;text-align:center; cursor:pointer;}
tbody td{padding:14px; border-bottom:1px solid #e2e8f0; text-align:center;}
tbody tr td:first-child, thead th:first-child{ text-align:left; padding-left:16px; }

input[type="number"], input[type="text"]{
  width:95%; padding:10px 8px; font-size:18px; font-weight:700; border-radius:var(--radius); border:1px solid var(--border); text-align:right; background:transparent;
}
input.targetField[readonly]{background:var(--highlight); font-weight:700;}

.calc-cell{font-weight:700; font-size:18px;}
tfoot td{padding:14px; font-size:17px; font-weight:700; color:#fff; background:var(--total-bg); text-align:right; border:none;}
tfoot td:first-child{text-align:left;padding-left:16px;}

.pctWrap{display:block;margin-top:8px;height:var(--bar-height);width:100%;background:#fee2e2;border-radius:999px; overflow:hidden;}
.pctBar{height:100%; width:0%; background:linear-gradient(90deg,var(--accent-start),var(--accent-mid),var(--accent-end)); transition:width 0.3s ease;}
.pctNumber{font-size:16px;margin-bottom:5px;}

button#exportPngBtn{padding:14px 18px;border-radius:8px;border:0;background:var(--accent-mid);color:#fff;font-weight:700;cursor:pointer; font-size:18px;}
</style>
</head>
<body>

<div class="wrap" id="campaignWrap">
  <h2>Campaign Performance</h2>
  <table id="campaignTable">
    <thead>
      <tr>
        <th>Campaign Code</th>
        <th>Campaign Name ↑↓</th>
        <th>Sale</th>
        <th>B-Sale</th>
        <th>Hours</th>
        <th>Headcount</th>
        <th>Target</th>
        <th>Avg/hour</th>
        <th>Avg/Agent</th>
        <th>% to Target</th>
        <th>Wait Time</th>
      </tr>
    </thead>
    <tbody id="campaignBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="2">Total</td>
        <td id="totalSale">0</td>
        <td id="totalBSale">0</td>
        <td id="totalHours">0</td>
        <td id="totalHeadcount">0</td>
        <td id="totalTarget">0</td>
        <td id="totalAvgHour">0</td>
        <td id="totalAvgAgent">0</td>
        <td id="totalPctTarget">0%</td>
        <td id="totalWait">0</td>
      </tr>
    </tfoot>
  </table>
</div>

<div class="wrap" id="teamsWrap">
  <h2>Teams Performance</h2>
  <table id="teamsTable">
    <thead>
      <tr>
        <th>Team Name</th>
        <th>Sale</th>
        <th>B-Sale</th>
        <th>Hours</th>
        <th>Headcount</th>
        <th>Target</th>
        <th>Avg/hour</th>
        <th>Avg/Agent</th>
        <th>% to Target</th>
      </tr>
    </thead>
    <tbody id="teamsBody"></tbody>
    <tfoot>
      <tr>
        <td>Total</td>
        <td id="teamTotalSale">0</td>
        <td id="teamTotalBSale">0</td>
        <td id="teamTotalHours">0</td>
        <td id="teamTotalHeadcount">0</td>
        <td id="teamTotalTarget">0</td>
        <td id="teamTotalAvgHour">0</td>
        <td id="teamTotalAvgAgent">0</td>
        <td id="teamTotalPctTarget">0%</td>
      </tr>
    </tfoot>
  </table>
</div>

<div style="width:96%; max-width:1400px; display:flex; justify-content:flex-end;">
  <button id="exportPngBtn">30min Update</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const campaigns=[["ABSA","ABSA",20],["CLKCTKP3","CARTRACK",70],["CT_TELEA","AUTO&GEN",60],["CT_TELEB","BUDGET",50],["CT_TELED","DIAL DIRECT",10],["CT_TELEF","FFW",60],["DISBIZLI","DISCOVERY",10],["ICNIWYZE","LIFE",20],["INCLMWDS","MIWAY",100],["INVCTAGP","INVCTAGP",20],["KP2_CTN","KING PRICE",35],["MIWAYNEW","MIWAYNEW",35],["OMDINVNT","OMDEALER",125]];
const teams=[["Team Chad",220],["Team Moses",200],["Team Prosper",172],["Team Sonwabile",72],["Trainees",70]];

function fmt(n){return n===null||n===undefined?'0':Number.isInteger(n)?n.toString():Number(n).toFixed(2);}
function recalcRow(row){
  const sale=parseFloat(row.querySelector('input.sale')?.value)||0;
  const hours=parseFloat(row.querySelector('input.hours')?.value)||0;
  const headcount=parseFloat(row.querySelector('input.headcount')?.value)||0;
  const target=parseFloat(row.querySelector('input.targetField')?.value)||0;
  row.querySelector('.avgHour')&&(row.querySelector('.avgHour').textContent=hours>0?(sale/hours).toFixed(2):'0');
  row.querySelector('.avgAgent')&&(row.querySelector('.avgAgent').textContent=headcount>0?(sale/headcount).toFixed(2):'0');
  const pctCell=row.querySelector('.pctTarget');
  if(pctCell){
    const pct=target>0?(sale/target*100):0;
    pctCell.querySelector('.pctNumber')&&(pctCell.querySelector('.pctNumber').textContent=pct.toFixed(1)+'%');
    pctCell.querySelector('.pctBar')&&(pctCell.querySelector('.pctBar').style.width=Math.min(100,pct)+'%');
  }
}

function updateTeamTotals(){
  let ts=0,tbs=0,th=0,thc=0,tt=0;
  Array.from(document.getElementById('teamsBody').rows).forEach(r=>{
    const s=parseFloat(r.querySelector('input.sale')?.value)||0;
    const b=parseFloat(r.querySelector('input.bsale')?.value)||0;
    const h=parseFloat(r.querySelector('input.hours')?.value)||0;
    const hc=parseFloat(r.querySelector('input.headcount')?.value)||0;
    const t=parseFloat(r.querySelector('input.targetField')?.value)||0;
    ts+=s;tbs+=b;th+=h;thc+=hc;tt+=t;recalcRow(r);
  });
  document.getElementById('teamTotalSale').textContent=fmt(ts);
  document.getElementById('teamTotalBSale').textContent=fmt(tbs);
  document.getElementById('teamTotalHours').textContent=fmt(th);
  document.getElementById('teamTotalHeadcount').textContent=fmt(thc);
  document.getElementById('teamTotalTarget').textContent=fmt(tt);
  document.getElementById('teamTotalAvgHour').textContent=th>0?(ts/th).toFixed(2):'0';
  document.getElementById('teamTotalAvgAgent').textContent=thc>0?(ts/thc).toFixed(2):'0';
  document.getElementById('teamTotalPctTarget').textContent=tt>0?((ts/tt*100).toFixed(1)+'%'):'0%';
}

function updateCampaignTotals(){
  let ts=0,tbs=0,th=0,thc=0,tt=0,wsum=0,wcount=0;
  Array.from(document.getElementById('campaignBody').rows).forEach(r=>{
    const s=parseFloat(r.querySelector('input.sale')?.value)||0;
    const b=parseFloat(r.querySelector('input.bsale')?.value)||0;
    const h=parseFloat(r.querySelector('input.hours')?.value)||0;
    const hc=parseFloat(r.querySelector('input.headcount')?.value)||0;
    const t=parseFloat(r.querySelector('input.targetField')?.value)||0;
    const w=r.querySelector('input.waitTime')?.value.trim();
    const wn=w!==""?parseFloat(w)||0:null;
    ts+=s;tbs+=b;th+=h;thc=hc;tt+=t;if(wn!==null){wsum+=wn;wcount++}recalcRow(r);
  });
  const avgWait=wcount>0?wsum/wcount:0;
  document.getElementById('totalSale').textContent=fmt(ts);
  document.getElementById('totalBSale').textContent=fmt(tbs);
  document.getElementById('totalHours').textContent=fmt(th);
  document.getElementById('totalHeadcount').textContent=fmt(thc);
  document.getElementById('totalTarget').textContent=fmt(tt);
  document.getElementById('totalAvgHour').textContent=th>0?(ts/th).toFixed(2):'0';
  document.getElementById('totalAvgAgent').textContent=thc>0?(ts/thc).toFixed(2):'0';
  document.getElementById('totalPctTarget').textContent=tt>0?((ts/tt*100).toFixed(1)+'%'):'0%';
  document.getElementById('totalWait').textContent=avgWait>0?avgWait.toFixed(2):'0';
}

function propagateHeadcountToCampaigns(){
  const totalHC=Array.from(document.getElementById('teamsBody').rows).reduce((acc,r)=>{const v=r.querySelector('input.headcount')?.value; return acc+(v===""?0:parseFloat(v)||0)},0);
  Array.from(document.getElementById('campaignBody').rows).forEach(r=>r.querySelector('input.headcount').value=totalHC);
  updateCampaignTotals();
}

function loadTeamRows(){
  const tbody=document.getElementById('teamsBody');tbody.innerHTML='';
  teams.forEach(t=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${t[0]}</td>
      <td><input class="small sale" type="number" value=""></td>
      <td><input class="small bsale" type="number" value=""></td>
      <td><input class="small hours" type="number" value=""></td>
      <td><input class="small headcount" type="number" value=""></td>
      <td><input class="small targetField" type="number" value="${t[1]}" readonly></td>
      <td class="calc-cell avgHour">0</td>
      <td class="calc-cell avgAgent">0</td>
      <td class="pctTarget"><div class="pctNumber">0%</div><div class="pctWrap"><div class="pctBar"></div></div></td>`;
    tbody.appendChild(tr);
    tr.querySelector('input.headcount').addEventListener('input',()=>{recalcRow(tr);updateTeamTotals();propagateHeadcountToCampaigns();});
    Array.from(tr.querySelectorAll('input')).forEach(inp=>{inp.addEventListener('input',()=>{recalcRow(tr);updateTeamTotals();});});
  });
}

function loadCampaignRows(){
  const tbody=document.getElementById('campaignBody');tbody.innerHTML='';
  campaigns.forEach(c=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${c[0]}</td><td style="text-align:left;padding-left:8px">${c[1]}</td>
      <td><input class="small sale" type="number" value=""></td>
      <td><input class="small bsale" type="number" value=""></td>
      <td><input class="small hours" type="number" value=""></td>
      <td><input class="small headcount" type="number" readonly value="0"></td>
      <td><input class="small targetField" type="number" value="${c[2]}" readonly></td>
      <td class="calc-cell avgHour">0</td>
      <td class="calc-cell avgAgent">0</td>
      <td class="pctTarget"><div class="pctNumber">0%</div><div class="pctWrap"><div class="pctBar"></div></div></td>
      <td><input class="small waitTime" type="number" value=""></td>`;
    tbody.appendChild(tr);
    Array.from(tr.querySelectorAll('input')).forEach(inp=>{inp.addEventListener('input',()=>{recalcRow(tr);updateCampaignTotals();updateTeamTotals();});});
  });
}

// High-res export with scaling
document.getElementById('exportPngBtn').addEventListener('click', async()=>{
  const container=document.createElement('div');
  container.style.background='#ffffff';
  container.style.display='inline-block';
  container.style.padding='20px';
  container.appendChild(document.getElementById('campaignWrap').cloneNode(true));
  container.appendChild(document.getElementById('teamsWrap').cloneNode(true));
  document.body.appendChild(container);
  const canvas=await html2canvas(container,{scale:2,useCORS:true,backgroundColor:'#ffffff'});
  document.body.removeChild(container);
  const dataUrl=canvas.toDataURL('image/png');
  const a=document.createElement('a');
  a.href=dataUrl;
  a.download='30min_report.png';
  a.click();
});

loadTeamRows();
loadCampaignRows();
updateTeamTotals();
propagateHeadcountToCampaigns();
updateCampaignTotals();
</script>
</body>
</html>
